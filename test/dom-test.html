<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes" />

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <link rel="import" href="../../../juicy-tile-table/juicy-tile-table.html" />
    <link rel="import" href="../src/juicy-tile-simple-editor.html" />

    <link rel="stylesheet" href="style.css" />
    <script src="juicy-tile-setup.js"></script>
</head>
<body>
    <test-fixture id="editor-form-fixture">
        <template>
            <div id="body" style="padding: 0px; margin: 0px;">
                <template is="dom-bind">
                    <juicy-tile-simple-editor></juicy-tile-simple-editor>
                    <juicy-tile-table id="table-0" setup="{{model.setup0}}" defaultsetup="{{model.setupCopy}}">
                        <div class="tile">tile-00</div>
                        <div class="tile">tile-01</div>
                    </juicy-tile-table>
                    <juicy-tile-table id="table-1" setup="{{model.setup1}}" defaultsetup="{{model.setupCopy}}">
                        <div class="tile">tile-10</div>
                        <div class="tile">tile-11</div>
                    </juicy-tile-table>
                </template>
                <script>
                    var script = document._currentScript || document.currentScript;
                    var tempalte = script.previousElementSibling;

                    tempalte.model = {
                        setup0: getJuicyTileSetup(),
                        setup1: getJuicyTileSetup(),
                        setupCopy: getJuicyTileSetup()
                    };
                </script>
            </div>
        </template>
    </test-fixture>

    <script src="helpers.js"></script>
    <script>
        describe("light dom test", function () {
            var fix;
            var editor;
            var tw;

            beforeEach(function (done) {
                fix = fixture("editor-form-fixture");
                editor = fix.querySelector("juicy-tile-simple-editor");

                tw = new JuicyTileTableWrapper(fix.querySelector("juicy-tile-table"));

                editor.addEventListener("attached", function () {
                    done();
                });
            });

            it("changes width of a tile on width button click", function (done) {
                dblclickPromise(tw.table)
                    .then(function () {
                        click(tw.tile(0));
                    })
                    .then(function () {
                        var btn = Polymer.dom(editor.root).querySelector(".editor-simple-form .width-section button:nth-child(6)");
                        click(btn);
                    })
                    .then(function () {
                        var rec = tw.tile(0).getBoundingClientRect();
                        expect(rec.width).to.be.equal(pageSize.width / 2);
                        done();
                    });
            });

            it("changes priority of a tile on priority arrow button click", function (done) {
                dblclickPromise(tw.table)
                    .then(function () {
                        click(tw.tile(0));
                    })
                    .then(function () {
                        var btn = Polymer.dom(editor.root).querySelector(".editor-simple-form .position-section button:nth-child(2)");
                        click(btn);
                    })
                    .then(function () {
                        var count = 2;

                        //The tile order is reversed now
                        for (var i = 0; i < count; i++) {
                            var rec = tw.tile(i).getBoundingClientRect();
                            expect(rec.top).to.be.equal((count - i - 1) * pageSize.tileHeight);
                        }

                        done();
                    });
            });

            it("hides a tile on eye button click", function (done) {
                dblclickPromise(tw.table)
                    .then(function () {
                        click(tw.tile(0));
                    })
                    .then(function () {
                        var btn = Polymer.dom(editor.root).querySelector(".editor-simple-form .visible-section button");
                        click(btn);
                    })
                    .then(function () {
                        var rec = tw.tile(0).getBoundingClientRect();
                        expect(rec.width).to.be.empty;
                        expect(rec.height).to.be.empty;
                        done();
                    });
            });
        });
    </script>
</body>
</html>
